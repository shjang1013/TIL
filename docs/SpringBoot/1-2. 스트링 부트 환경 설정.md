# 스프링 부트 환경 설정

<br>

## 스프링 부트 시작하기
### 프로젝트 생성
* JDK 설치
* 인텔리제이 IDEA 사용하기
* 프로젝트 유형을 그레이들로 선택해 프로젝트 생성

### HelloWorld
<img src="./resources/HelloWorld.png">

* `@RestController`
    - @Controller와 @ResponseBody를 합쳐놓은 역할을 수행된다.  
    - 어노테이션을 사용하면 반환값이 Response Body 부분에 자동으로 바인딩된다.  
    - 스프링에서 RESTful 웹 서비스를 만들 때 주로 사용
* `@GetMapping`
    - Get 방식으로 경로를 받는 매핑 어노테이션
    - value 값을 별도로 지정하지 않으면 기본값인 빈 값이 들어간다.
    
* 메인 메서드를 실행한 후 브라우저에서 `localhost:8080`에 접속하여 "Hello World"가 제대로 출력되는지 확인한다.

<br>

## 그레이들
### 그레이들과 메이븐의 특징
* 그레이들
    - 기본적인 빌도 도구의 기능
    - 메이븐으로부터 의존 라이브러리 관리 기능을 차용
    - 멀티 프로젝트 구성 시 설정 주입 방식을 사용
* 메이븐
    - 메이븐 설정 파일인 pom.xml은 XML 기반으로 작서
    - 동적인 행위에 제약이 존재
    - 멀티 프로젝트 구성 시 상속 구조로 이루어짐
    
### 그레이들 프로젝트 구조
```
├── gradle
|    └── wrapper
|        ├── gradle-wrapper.jar
|        └── gradle-wrapper.properties
├── gradlew
└── gradlew.bat
```
* gradlew
    - 리눅스 및 맥 OS용 셸 스크립트
    - 버전 변경 명령어
        - `./gradlew wrapper --gradle-version 4.10.2`
* gradlew.bat
    - 윈도우용 배치 스크립트
* gradle/wrapper/gradle-wrapper.jar
    - Wrapper JAR
* gradle/wrapper/gradle-wrapper.properties
    - 그레이들 설정 정보 프로퍼티 파일(버전 정보 등)
    - distributionUrl을 원하는 그레이들 버전으로 수정
    
위의 파일은 모두 그레이들 래퍼와 관련된 설정이며 프로젝트 첫 설정 시 그레이들 관련 빌드 설정을 자동으로 해준다.  

### 그레이들 멀티 프로젝트 구성하기
* 그레이들 멀티 프로젝트를 활용하면 여러 프로젝트를 마치 하나의 프로젝트처럼 사용할 수 있다.  
    - 공통 코드를 하나의 프로젝트로 분리하고 이를 재사용할 때 유리하다.  

1. setting.gradle 파일에 루트 프로젝트를 추가한다.
    - setting.gradle 파일 : 그레이들 설정 파일
    - 특정한 명령 규칙에 따라 그레이들에서 자동으로 인식하여 설정한다.
    - rootProject.name = 'SpringBoot-study'
    
2. `SpringBoot-study-web` 모듈을 생성한다.
    - 루트 경로에서 New - Module 선택

3. ArtifactId에 `SpringBoot-study-web`을 입력한 후 모듈을 생성한다.

4. `SpringBoot-study-web` 모듈에는 build.gradle 파일만 존재한다.
    - 기본 패키지 경로는 수동으로 생성
    - src/main/java : 자바 소스 경로
    - src/test/java : 스프링 부트의 테스트 코드 경로
    - src/main/resources/static : static한 파일(css, image, js 등)의 디폴트 경로
    - src/main/resources/templates : thymeleaf, freemarker 및 기타 서버 사이드 템플릿 파일의 경로

#### SpringBoot-study 프로젝트 멀티 모듈 구조
```
├── .gradle
├── .idea
├── gradle
├── SpringBoot-study-domain
|    └── src
|         ├── main
|         |    └── java
|         |         └── com
|         |              └── sohyeon
|         └── test
|              └── java
|                   └── com
|                        └── sohyeon
└── SpringBoot-study-web
     └── src
          ├── main
          |    ├── java
          |    |    └── com
          |    |         └── sohyeon
          |    └── resources
          |         ├── static
          |         └── templates
          └── test
               └── java
                    └── com
                         └── sohyeon
```
<br>

## 환경 프로퍼티 파일 설정
### 환경 프로퍼티 파일의 특징
* 스프링 부트 프로퍼티 파일은 설정 관련 및 기타 정적인 값을 키값 형식으로 관리한다.  
    - 기존 스프링 프레임워크의 복잡한 XML 설정을 파일 하나로 설정할 수 있다.  
* 최근에는 프로퍼티 파일의 표현의 한계로 `YAML 파일`을 더 많이 사용한다.  
* YAML 파일은 프로퍼티 설정값의 깊에에 따라 들여쓰기를 해서 계층 구조를 훨씬 쉽게 파악할 수 있다.

### 프로파일에 따른 환경 구성 분리
실제 서비스에서 개발한다면 로컬 DB, 개발 DB, 운영 DB의 설정값이 모두 다르다.  
    - 이런 경우를 대비해 `프로파일에 따라 프로퍼티를 다르게 설정`해야 한다.
    
1. YAML 파일에서 프로퍼티 설정을 구분하는 방법
    - `---`을 기준으로 설정값을 나눈다.
2. application-{profile}.yml을 이용한다.
    - 프로퍼티 적용 우선순위는 application-{profile}.yml이 1순위다.
    - 나머지 프로퍼티 값들은 application.yml의 설정으로 적용된다.

#### application.yml에서 프로파일별 설정 구분 예시
```
server:
    port: 80
---
spring:
    profiles: local
server:
    port: 8080
---
spring:
    profiles: dev
server:
    port: 8081
---
spring:
    profiles: real
server:
    port: 8082
```

### 프로파일값을 적용하여 애플리케이션을 실행하는 방법
* local, dev, real과 같이 각각의 프로파일값을 따로 지정하여 애플리케이션을 실행한다.
    - 스프링 부트 프로젝트는 JAR 파일로 빌드하여 서버에서 실행할 수 있다.
    - `$ java -jar ... -D spring.profiles.active=dev`
* 인텔리제이는 스프링 부트 실행 플러그인을 따로 사용한다.
    - Edit Configurations 버튼을 눌러 Run/Debug Configurations 창을 실행한다.
    - 스프링 부트 플러그인의 프로파일값을 할당한다.
    
### YAML 파일 매핑하기
* YAML 파일을 사용하면 깊이에 따라 관계를 구분 짓기 때문에 List, Set, Map 등 다양한 바인딩형 매핑이 훨씬 간편하다.  
* YAML 파일에 있는 데이터를 가져와서 사용하는 방법
    - @Value
        - SpEL(Spring Expression Languate, 스프링 표현 언어) 평가
            - SpEL은 런타임에 객체 참조에 대해 질의하고 조작하는 기능을 지원하는 언어다.
            - 메서드 호출 및 기본 문자열 템플릿 기능을 제공한다.
    - @ConfigurationProperties
        - 유연한 바인딩
            - 프로퍼티값을 객체에 바인딩할 경우 필드를 낙타 표기법으로 선언하고 프로퍼티의 키는 다양한 형식(낙타, 케밥, 언더바 표기법)으로 선언하여 바인딩할 수 있다. 
        - 메타데이터 지원
            - 프로퍼티의 키에 대한 정보를 메타데이터 파일(JSON)로 제공한다.

### @Value

### @Configuration
<br>

## Reference & Additional Resources
> 처음 배우는 스프링 부트2


